lapply(function(x){ x[!is.na(x) & x != ""]}) %>%
as_tibble(.name_repair = "universal") %>%
mutate(Cases = str_extract_all(...1, '\\d+')) %>%
mutate(Cases = unlist(Cases)) %>%
mutate(County = str_remove_all(...1, "\\d+")) %>%
mutate(County = str_trim(County)) %>%
mutate(County = str_remove_all(County, "'")) %>%
mutate(Cases = as.integer(Cases)) %>%
mutate(Date = Sys.Date()) %>%
mutate(State = "Maryland") %>%
left_join(stateConversions, by = c("State" = "Full_Name")) %>%
left_join(countyStateFIPS, by = c("Abbr" = "State", "County" = "Name")) %>%
dplyr::select(County, Cases, Date, State, Abbr, FIPS)
MD_By_County_Today
MD_By_County <- read_csv("MD_By_County.csv")
MD_By_County <- bind_rows(MD_By_County_Today, MD_By_County)
write_csv(MD_By_County, "MD_By_County.csv")
mdAgeSexBreakdown <- casesByAgeAndSex %>%
str_split("\n") %>%
unlist()
mdSexBreakdown <- mdAgeSexBreakdown[10]
mdSexBreakdown <- mdSexBreakdown %>%
str_split(",") %>%
unlist() %>%
str_split(": ") %>%
as_tibble(.name_repair = "universal")
colnames(mdSexBreakdown) <- unlist(unname(mdSexBreakdown[1,]))
colnames(mdSexBreakdown) <- str_trim(unlist(colnames(mdSexBreakdown)))
mdSexBreakdown <- mdSexBreakdown[2,]
mdSexBreakdownToday <- mdSexBreakdown %>%
mutate(Female = as.integer(Female), Male = as.integer(Male), Date = Sys.Date(), State = "Maryland") %>%
pivot_longer(cols = c("Female", "Male")) %>%
mutate(Sex = name, Cases = value) %>%
select(Sex, Cases, Date, State)
mdSexBreakdownToday
mdSexBreakdown <- read_csv("mdSexBreakdown.csv")
mdSexBreakdown
bind_rows(mdSexBreakdownToday, mdSexBreakdown)
mdSexBreakdown <- bind_rows(mdSexBreakdownToday, mdSexBreakdown)
write_csv(mdSexBreakdown, "mdSexBreakdown.csv")
mdAgeBreakdownToday <- mdAgeSexBreakdown[1:9]
mdAgeBreakdownToday <- mdAgeBreakdownToday %>%
str_split( " ")
mdAgeBreakdownToday <- do.call(rbind, mdAgeBreakdownToday)
colnames(mdAgeBreakdownToday) <- c("Age_Range", "Cases")
mdAgeBreakdownToday <- mdAgeBreakdownToday %>%
as_tibble() %>%
mutate(Cases = as.integer(Cases), Date = Sys.Date(), State = "Maryland")
mdAgeBreakdownToday
MD_By_Age <- read_csv("MD_By_Age.csv")
bind_rows(mdAgeBreakdownToday, MD_By_Age)
MD_By_Age <- bind_rows(mdAgeBreakdownToday, MD_By_Age)
write_csv(MD_By_Age, "MD_By_Age.csv")
Virginia_By_County_Today <- read_csv("Virginia_By_County_Today.csv", locale = locale(encoding = "UTF-8"))
Virginia_By_County_Today <- Virginia_By_County_Today %>%
rename(County = Locality, Date = `Report Date`, Cases = `Total Cases`) %>%
mutate(State = "Virginia") %>%
mutate(Date = mdy(Date)) %>%
left_join(stateConversions, by = c("State" = "Full_Name")) %>%
dplyr::select(County, Cases, Date, State, Abbr, FIPS)
Virginia_By_County_Today
Virginia_By_County <- read_csv("Virginia_By_County.csv")
Virginia_By_County
bind_rows(Virginia_By_County_Today, Virginia_By_County)
Virginia_By_County <- bind_rows(Virginia_By_County_Today, Virginia_By_County)
write_csv(Virginia_By_County, "Virginia_By_County.csv")
Virginia_By_Age_Today <- read_csv("Virginia_By_Age_Today.csv")
Virginia_By_Age_Today <- Virginia_By_Age_Today %>%
mutate(Date = `Report Date`, Age_Range = `Age Group`, Cases = `Number of Cases`, State = "Virginia") %>%
mutate(Date = mdy(Date)) %>%
select(Age_Range, Cases, Date, State)
Virginia_By_Age_Today
Virginia_By_Age <- read_csv("Virginia_By_Age.csv")
bind_rows(Virginia_By_Age_Today, Virginia_By_Age)
Virginia_By_Age <- bind_rows(Virginia_By_Age_Today, Virginia_By_Age)
write_csv(Virginia_By_Age, "Virginia_By_Age.csv")
Virginia_By_Sex_Today <- read_csv("Virginia_By_Sex_Today.csv")
Virginia_By_Sex_Today <- Virginia_By_Sex_Today %>%
mutate(Date = `Report Date`, Cases = `Number of Cases`, State = "Virginia") %>%
mutate(Date = mdy(Date)) %>%
select(Sex, Cases, Date, State)
Virginia_By_Sex_Today
Virginia_By_Sex <- read_csv("Virginia_By_Sex.csv")
bind_rows(Virginia_By_Sex_Today, Virginia_By_Sex)
Virginia_By_Sex <- bind_rows(Virginia_By_Sex_Today, Virginia_By_Sex)
write_csv(Virginia_By_Sex, "Virginia_By_Sex.csv")
Virginia_By_Race_Today <- read_csv("Virginia_By_Race_Today.csv")
Virginia_By_Race_Today <- Virginia_By_Race_Today %>%
mutate(Date = `Report Date`, Cases = `Number of Cases`, State = "Virginia") %>%
mutate(Date = mdy(Date)) %>%
select(Race, Cases, Date, State)
Virginia_By_Race_Today
Virginia_By_Race <- read_csv("Virginia_By_Race.csv")
bind_rows(Virginia_By_Race_Today, Virginia_By_Race)
Virginia_By_Race <- bind_rows(Virginia_By_Race_Today, Virginia_By_Race)
write_csv(Virginia_By_Race, "Virginia_By_Race.csv")
Virginia_Totals_Numbers <- pdf_text(paste0(paste("Virginia", "COVID-19", "Dashboard", Sys.Date(), sep = " "), ".pdf")) %>%
str_remove_all("\n") %>%
str_remove_all(",") %>%
str_remove_all("(\\s{1,})") %>%
str_extract_all("\\d+") %>%
unlist()
Virginia_Totals_Headers <- pdf_text(paste0(paste("Virginia", "COVID-19", "Dashboard", Sys.Date(), sep = " "), ".pdf")) %>%
str_remove_all("\n") %>%
str_remove_all(",") %>%
str_remove_all("(\\s{1,})") %>%
str_remove_all("Total") %>%
str_extract_all("[[:alpha:]]+") %>%
unlist()
Virginia_Totals_Numbers
Virginia_Totals_Headers
Virginia_Totals_Headers[1] <- "Tests"
Virginia_Totals <- as.data.frame(rbind(Virginia_Totals_Headers, Virginia_Totals_Numbers), row.names = F, stringsAsFactors = F)
Virginia_Totals <- Virginia_Totals[2,]
colnames(Virginia_Totals) <- Virginia_Totals_Headers
Virginia_Totals$Date <- Sys.Date()
Virginia_Totals$Tests <- as.integer(Virginia_Totals$Tests)
Virginia_Totals$Hospitalizations <- as.integer(Virginia_Totals$Hospitalizations)
Virginia_Totals$Deaths <- as.integer(Virginia_Totals$Deaths)
Virginia_Totals$State <- "Virginia"
Virginia_Totals_Today <- Virginia_Totals
Virginia_Totals_Today
Virginia_Totals <- read_csv("VirginiaTotals.csv")
bind_rows(Virginia_Totals_Today, Virginia_Totals)
Virginia_Totals <- bind_rows(Virginia_Totals_Today, Virginia_Totals)
write_csv(Virginia_Totals, "VirginiaTotals.csv")
Virginia <- Virginia_Totals_Today[c(1, 2, 4)]
Virginia$Cases <- sum(Virginia_By_County$Cases)
Virginia$State <- "Virginia"
Virginia <- Virginia %>%
select(State, Cases, Deaths, Tests, Date)
MD_Summary_Today$Tests
MD_By_County_Today
sum(MD_By_County_Today$Cases)
sum(MD_Summary_Today$Tests, sum(MD_By_County_Today$Cases))
Virginia
tibble(State = "Maryland",
Cases = sum(MD_By_County$Cases),
Deaths = MD_Summary_Today$Deaths,
Tests = sum(MD_Summary_Today$Tests, sum(MD_By_County_Today$Cases)), # Fix this earlier by swaping the MD_Cases_By_County before the MD_Summary and replace the old test number with the test number plus the total cases for all counties.
Date = Sys.Date())
Maryland <- tibble(State = "Maryland",
Cases = sum(MD_By_County$Cases),
Deaths = MD_Summary_Today$Deaths,
Tests = sum(MD_Summary_Today$Tests, sum(MD_By_County_Today$Cases)), # Fix this earlier by swaping the MD_Cases_By_County before the MD_Summary and replace the old test number with the test number plus the total cases for all counties.
Date = Sys.Date())
virginiaCounties <- Virginia_By_County_Today %>%
filter(County %in% c("Alexandria", "Arlington", "Fairfax", "Loudoun", "Prince William", "Culpeper")) %>%
mutate(Deaths = NA) %>%
mutate(Tests = NA) %>%
select(County, Cases, Deaths, Tests, Date)
marylandCounties <- MD_By_County_Today %>%
filter(County %in% c("Montgomery", "Prince Georges", "Frederick", "Calvert")) %>%
mutate(Deaths = NA) %>%
mutate(Tests = NA) %>%
select(County, Cases, Deaths, Tests, Date)
marylandCounties
virginiaCounties
bind_rows(dcSummary, Maryland, marylandCounties, Virginia, virginiaCounties)
bind_rows(dcSummary, Maryland, marylandCounties, Virginia, virginiaCounties) %>%
select(State, County, Cases, Deaths, Tests, Date)
bind_rows(dcSummary, Maryland, marylandCounties, Virginia, virginiaCounties)
bind_rows(dcSummary, Maryland, marylandCounties, Virginia, virginiaCounties) %>%
select(State, County, Cases, Deaths, Tests, Date)
dailySummaryToday <- bind_rows(dcSummary, Maryland, marylandCounties, Virginia, virginiaCounties) %>%
select(State, County, Cases, Deaths, Tests, Date)
dailySummary <- read_csv("covidSummaryDCist.csv")
dailySummary
bind_rows(dailySummaryToday, dailySummary)
dailySummary <- bind_rows(dailySummaryToday, dailySummary)
write_csv(dailySummary, "covidSummaryDCist.csv")
Full_States <- read_csv("FullStates.csv")
bind_rows(Full_States, Virginia_By_County, MD_By_County, WV_CountiesDFCleaned, DC_By_County) %>%
arrange(desc(Date))
Full_States <- bind_rows(Full_States, Virginia_By_County, MD_By_County, WV_CountiesDFCleaned, DC_By_County) %>%
arrange(desc(Date))
Full_States %>%
mutate(County = unlist(lapply(County, str_remove_all, "'"))) %>%
mutate(County = unlist(lapply(County, str_remove_all, "/."))) %>%
mutate(County = case_when(County %in% c("Alexandria", "Harrisonburg", "Chesapeake", "Newport News", "Williamsburg", "Portsmouth", "Charlottesville", "Virginia Beach", "Suffolk", "Norfolk") ~ paste(County, "City", sep = " "),
County %in% c("Franklin County", "Baltimore County") ~ str_remove(County, ".County"),
str_detect(County, "Chesterf.*")  ~ "Chesterfield",
str_detect(County, 'Sta..ord') ~ "Stafford",
str_detect(County, 'Su..olk') ~ "Suffolk City",
str_detect(County, ".*Marys") ~ "St Marys",
T ~ County))
Full_States <- Full_States %>%
mutate(County = unlist(lapply(County, str_remove_all, "'"))) %>%
mutate(County = unlist(lapply(County, str_remove_all, "/."))) %>%
mutate(County = case_when(County %in% c("Alexandria", "Harrisonburg", "Chesapeake", "Newport News", "Williamsburg", "Portsmouth", "Charlottesville", "Virginia Beach", "Suffolk", "Norfolk") ~ paste(County, "City", sep = " "),
County %in% c("Franklin County", "Baltimore County") ~ str_remove(County, ".County"),
str_detect(County, "Chesterf.*")  ~ "Chesterfield",
str_detect(County, 'Sta..ord') ~ "Stafford",
str_detect(County, 'Su..olk') ~ "Suffolk City",
str_detect(County, ".*Marys") ~ "St Marys",
T ~ County)) #%>%
# left_join(stateConversions, by = c("State" = "Full_Name")) %>%
# left_join(countyStateFIPS, by = c("Abbr" = "State", "County" = "Name"))
Full_States %>%
distinct()
Full_States %>%
distinct() %>%
write_csv("FullStates.csv")
Full_States <- Full_States %>% distinct()
DMV_Counties <- c("District of Columbia",
"Calvert", "Charles", "Frederick", "Montgomery", "Prince Georges",
"Alexandria", "Arlington", "Clarke", "Culpeper", "Fairfax", "Farquier", "Fredericksburg", "Loudoun", "Manassas", "Prince William", "Rappahannock", "Spotsylvania", "Stafford", "Warren",
"Jefferson")
DMV_FIPS <- c("11001", "24009", "24017", "24021", "24031", "24033", "51510", "51013", "51043", "51047", "51059", "51061", "51630", "51107", "51683", "51153", "51157", "51177", "51179", "51187", "54037", "51600", "51610")
DMV_Closer_FIPS <- c("24031", "24033", "24021", "24009", "51510", "51013", "51059", "51600", "51107", "51153", "51047", "11001")
Full_States %>%
mutate(FIPS = as.character(FIPS)) %>%
filter(FIPS %in% DMV_FIPS)
DMV_Counties_Covid_Cases <- Full_States %>%
mutate(FIPS = as.character(FIPS)) %>%
filter(FIPS %in% DMV_FIPS)
DMV_Counties_Covid_Cases %>%
DMV_Counties_Covid_Cases %>% filter(County == 'Fairfax City')
DMV_Counties_Covid_Cases
DMV_Counties_Covid_Cases %>% filter(County == "Fairfax City")
DMV_Counties_Covid_Cases
write_csv(DMV_Counties_Covid_Cases, "DMVCountiesCovidCases.csv")
covid19Theme <- function() {
theme_classic() +
theme(text = element_text(family = "Georgia", color = "gray25"),
plot.title = element_text(size = 24, face = "bold"),
plot.subtitle = element_text(size = 16),
plot.caption = element_text(color = "gray30", size = 12),
legend.position = "right",
legend.text = element_text(color = "gray30", size = 16),
legend.title = element_text(color = "gray30", size = 18),
axis.text = element_text(color = "gray25", size = 14)
)
}
ggplotCaption <- "Data from: DC Mayor's Office, MD Dept of Health, VA Dept of Health"
DMV_Counties_Covid_Cases %>%
filter(Date >= as.Date("2020-03-23")) %>%
filter(FIPS %in% DMV_Closer_FIPS) %>%
ggplot(aes(x = Date, y = Cases)) +
geom_line(aes(color = County), size = 3) +
geom_point(aes(shape = State, color = County), size = 6) +
scale_y_log10() +
covid19Theme() +
scale_color_brewer(palette = "Paired") +
labs(title = "DMV Covid-19 cases by county", subtitle = "Over time", caption = ggplotCaption) + xlab("") + ylab("")
dmvCasesByCountyLine <- DMV_Counties_Covid_Cases %>%
filter(Date >= as.Date("2020-03-23")) %>%
filter(FIPS %in% DMV_Closer_FIPS) %>%
ggplot(aes(x = Date, y = Cases)) +
geom_line(aes(color = County), size = 3) +
geom_point(aes(shape = State, color = County), size = 6) +
scale_y_log10() +
covid19Theme() +
scale_color_brewer(palette = "Paired") +
labs(title = "DMV Covid-19 cases by county", subtitle = "Over time", caption = ggplotCaption) + xlab("") + ylab("")
ggsave(filename = "/home/adrian/Documents/Personal_Portfolio_Site/DMV_Covid-19/dmvCasesByCountyLine.png", plot = dmvCasesByCountyLine, width = 275, height = 250, units = 'mm')
DMV_Counties_Covid_Cases %>%
filter(Date == max(Date)) %>%
filter(FIPS %in% DMV_Closer_FIPS) %>%
ggplot(aes(x = State, y = Cases, fill = reorder(County, -Cases))) +
geom_col(position = "dodge") +
geom_text(aes(label = Cases), vjust = -0.2, size = 7, position = position_dodge2(width = 0.9, reverse = F)) +
covid19Theme() +
scale_fill_brewer(palette = "Paired") +
labs(title = "DMV Covid-19 cases by county", subtitle = paste("On", Sys.Date(), sep = " "), caption = ggplotCaption) + xlab("") + ylab("") +
guides(fill=guide_legend(title="County"))
dmvCasesByCountyBar <- DMV_Counties_Covid_Cases %>%
filter(Date == max(Date)) %>%
filter(FIPS %in% DMV_Closer_FIPS) %>%
ggplot(aes(x = State, y = Cases, fill = reorder(County, -Cases))) +
geom_col(position = "dodge") +
geom_text(aes(label = Cases), vjust = -0.2, size = 7, position = position_dodge2(width = 0.9, reverse = F)) +
covid19Theme() +
scale_fill_brewer(palette = "Paired") +
labs(title = "DMV Covid-19 cases by county", subtitle = paste("On", Sys.Date(), sep = " "), caption = ggplotCaption) + xlab("") + ylab("") +
guides(fill=guide_legend(title="County"))
ggsave(filename = "/home/adrian/Documents/Personal_Portfolio_Site/DMV_Covid-19/dmvCasesByCountyBar.png", plot = dmvCasesByCountyBar, width = 300, height = 250, units = 'mm')
dailySummary %>%
drop_na(Tests) %>%
ggplot(aes(x = Date, y = Tests)) +
geom_line(aes(color = State), na.rm = T, size = 3) +
geom_point(aes(shape = State, color = State), size = 6) +
scale_color_manual(values = c("#E91436", "#ebab00ff", "#00257C")) +
covid19Theme() +
labs(title = "DMV Covid-19 tests", subtitle = "Over time", caption = ggplotCaption) + xlab("") + ylab("")
seq(min(dailySummary$Tests, na.rm = T), max(dailySummary$Tests, na.rm = T), by = 1000)
dailySummary %>%
drop_na(Tests) %>%
ggplot(aes(x = Date, y = Tests)) +
geom_line(aes(color = State), na.rm = T, size = 3) +
geom_point(aes(shape = State, color = State), size = 6) +
scale_y_continuous(breaks = seq(min(dailySummary$Tests, na.rm = T), max(dailySummary$Tests, na.rm = T), by = 1000))
scale_color_manual(values = c("#E91436", "#ebab00ff", "#00257C")) +
covid19Theme() +
labs(title = "DMV Covid-19 tests", subtitle = "Over time", caption = ggplotCaption) + xlab("") + ylab("")
dailySummary %>%
drop_na(Tests) %>%
ggplot(aes(x = Date, y = Tests)) +
geom_line(aes(color = State), na.rm = T, size = 3) +
geom_point(aes(shape = State, color = State), size = 6) +
scale_y_continuous(breaks = seq(min(dailySummary$Tests, na.rm = T), max(dailySummary$Tests, na.rm = T), by = 1000)) +
scale_color_manual(values = c("#E91436", "#ebab00ff", "#00257C")) +
covid19Theme() +
labs(title = "DMV Covid-19 tests", subtitle = "Over time", caption = ggplotCaption) + xlab("") + ylab("")
dailySummary %>%
drop_na(Tests) %>%
ggplot(aes(x = Date, y = Tests)) +
geom_line(aes(color = State), na.rm = T, size = 3) +
geom_point(aes(shape = State, color = State), size = 6) +
scale_y_continuous(breaks = seq(0, max(dailySummary$Tests, na.rm = T), by = 1000)) +
scale_color_manual(values = c("#E91436", "#ebab00ff", "#00257C")) +
covid19Theme() +
labs(title = "DMV Covid-19 tests", subtitle = "Over time", caption = ggplotCaption) + xlab("") + ylab("")
seq(0, max(dailySummary$Tests, na.rm = T), by = 1000)
DMVTestsLine <- dailySummary %>%
drop_na(Tests) %>%
ggplot(aes(x = Date, y = Tests)) +
geom_line(aes(color = State), na.rm = T, size = 3) +
geom_point(aes(shape = State, color = State), size = 6) +
scale_y_continuous(breaks = seq(0, max(dailySummary$Tests, na.rm = T), by = 1000)) +
scale_color_manual(values = c("#E91436", "#ebab00ff", "#00257C")) +
covid19Theme() +
labs(title = "DMV Covid-19 tests", subtitle = "Over time", caption = ggplotCaption) + xlab("") + ylab("")
ggsave(filename = "/home/adrian/Documents/Personal_Portfolio_Site/DMV_Covid-19/DMVTestsLine.png", plot = DMVTestsLine, width = 275, height = 250, units = 'mm')
dailySummary %>%
drop_na(Tests) %>%
filter(Date == max(Date)) %>%
ggplot(aes(x = State, y = Tests)) +
geom_col(aes(fill = State), na.rm = T) +
geom_text(aes(label = Tests), vjust = -0.2, size = 8) +
scale_fill_manual(values = c("#E91436", "#ebab00ff", "#00257C")) +
covid19Theme() +
labs(title = "DMV Covid-19 tests", subtitle = paste("On", Sys.Date(), sep = " "), caption = ggplotCaption) + xlab("") + ylab("")
DMVTestsBar
DMVTestsBar <- dailySummary %>%
drop_na(Tests) %>%
filter(Date == max(Date)) %>%
ggplot(aes(x = State, y = Tests)) +
geom_col(aes(fill = State), na.rm = T) +
geom_text(aes(label = Tests), vjust = -0.2, size = 8) +
scale_fill_manual(values = c("#E91436", "#ebab00ff", "#00257C")) +
covid19Theme() +
labs(title = "DMV Covid-19 tests", subtitle = paste("On", Sys.Date(), sep = " "), caption = ggplotCaption) + xlab("") + ylab("")
ggsave(filename = "/home/adrian/Documents/Personal_Portfolio_Site/DMV_Covid-19/DMVTestsBar.png", plot = DMVTestsBar, width = 275, height = 250, units = 'mm')
dailySummary %>%
drop_na(State) %>%
ggplot(aes(x = Date, y = Deaths)) +
geom_line(aes(color = State), na.rm = T, size = 3) +
geom_point(aes(color = State, shape = State), na.rm = T, size = 6) +
scale_color_manual(values = c("#E91436", "#EBAB00", "#00257C")) +
scale_y_continuous(breaks = seq(min(dailySummary$Deaths, na.rm = T), max(dailySummary$Deaths, na.rm = T), by = 1)) +
covid19Theme() +
labs(title = "DC & VA Covid-19 deaths", subtitle = "Over time", caption = ggplotCaption) + xlab("") + ylab("")
dcmdvaDeathsLine <- dailySummary %>%
drop_na(State) %>%
ggplot(aes(x = Date, y = Deaths)) +
geom_line(aes(color = State), na.rm = T, size = 3) +
geom_point(aes(color = State, shape = State), na.rm = T, size = 6) +
scale_color_manual(values = c("#E91436", "#EBAB00", "#00257C")) +
scale_y_continuous(breaks = seq(min(dailySummary$Deaths, na.rm = T), max(dailySummary$Deaths, na.rm = T), by = 1)) +
covid19Theme() +
labs(title = "DC & VA Covid-19 deaths", subtitle = "Over time", caption = ggplotCaption) + xlab("") + ylab("")
ggsave(filename = "/home/adrian/Documents/Personal_Portfolio_Site/DMV_Covid-19/dcmdvaDeathsLine.png", plot = dcmdvaDeathsLine, width = 275, height = 250, units = 'mm')
dailySummary %>%
drop_na(State) %>%
filter(Date == max(Date)) %>%
ggplot(aes(x = State, y = Deaths)) +
geom_col(aes(fill = State), na.rm = T) +
geom_text(aes(label = Deaths), vjust = -0.2, size = 8) +
scale_fill_manual(values = c("#E91436", "#EBAB00", "#00257C")) +
covid19Theme() +
labs(title = "DC & VA Covid-19 deaths", subtitle = paste("On", Sys.Date(), sep = " "), caption = ggplotCaption) + xlab("") + ylab("")
dcmdvaDeathsBar <- dailySummary %>%
drop_na(State) %>%
filter(Date == max(Date)) %>%
ggplot(aes(x = State, y = Deaths)) +
geom_col(aes(fill = State), na.rm = T) +
geom_text(aes(label = Deaths), vjust = -0.2, size = 8) +
scale_fill_manual(values = c("#E91436", "#EBAB00", "#00257C")) +
covid19Theme() +
labs(title = "DC & VA Covid-19 deaths", subtitle = paste("On", Sys.Date(), sep = " "), caption = ggplotCaption) + xlab("") + ylab("")
ggsave(filename = "/home/adrian/Documents/Personal_Portfolio_Site/DMV_Covid-19/dcmdvaDeathsBar.png", plot = dcmdvaDeathsBar, width = 275, height = 300, units = 'mm')
counties <- st_read("tl_2019_us_county.shp")
DMV <- counties %>%
mutate(GEOID = as.character(GEOID)) %>%
filter(GEOID %in% DMV_FIPS)
# plot(st_geometry(DMV))
DMV_Counties_Covid_Cases_Today <- DMV_Counties_Covid_Cases %>%
filter(Date == max(Date))
DMV_Cases <- DMV %>%
left_join(DMV_Counties_Covid_Cases_Today, by = c("GEOID" = "FIPS"))
DMV_Cases <- DMV_Cases %>%
mutate(Cases = if_else(is.na(Cases), 0, Cases))
st_crs(DMV_Cases) <- "+proj=longlat +datum=WGS84"
seq(from = 1, to = max(DMV_Cases$Cases), by = (max(DMV_Cases$Cases) / 5))
myBins <- seq(from = 1, to = max(DMV_Cases$Cases), by = (max(DMV_Cases$Cases) / 5))
dmvPalette <- colorBin(palette = "YlOrRd", domain = DMV_Cases$Cases, na.color = "transparent", bins = myBins)
legendText <- paste0(
"County: ", DMV_Cases$NAME, "<br/>",
"State: ", DMV_Cases$State, "<br/>",
"Cases: ", DMV_Cases$Cases, "<br/>"
) %>%
lapply(htmltools::HTML)
attribution <- htmltools::HTML("Map data &copy; <a href='https://www.openstreetmap.org/'>OpenStreetMap</a> contributors, <a href='https://creativecommons.org/licenses/by-sa/2.0/'>CC-BY-SA</a><br/>Data from: <a href = 'https://dhhr.wv.gov/COVID-19/Pages/default.aspx'>WV DHHR</a>, <a href='https://coronavirus.dc.gov/page/coronavirus-data'>DC Mayor's Office</a>, <a href='https://coronavirus.maryland.gov/'>MD Dept of Health</a>, <a href='http://www.vdh.virginia.gov/coronavirus/'>VA Dept of Health</a>")
leaflet(DMV_Cases) %>%
addTiles(attribution = attribution) %>%
setView(lat = "38.8858", lng = "-77.1054", zoom = 8) %>%
addPolygons(stroke=T,
opacity = 1,
fillOpacity = 0.9,
smoothFactor = 0.5,
color = "black",
fillColor = ~dmvPalette(Cases),
weight = 0.5,
label = legendText,
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "3px 8px"),
textsize = "13px",
direction = "auto"
)) %>%
addLegend( pal=dmvPalette, values=~Cases, opacity=0.9, title = paste("DMV Covid-19 Cases on", Sys.Date()), position = "topright" )
myBins
round(seq(from = 1, to = max(DMV_Cases$Cases), by = (max(DMV_Cases$Cases) / 6)), 0)
myBins <- round(seq(from = 1, to = max(DMV_Cases$Cases), by = (max(DMV_Cases$Cases) / 6)), 0)
dmvPalette <- colorBin(palette = "YlOrRd", domain = DMV_Cases$Cases, na.color = "transparent", bins = myBins)
leaflet(DMV_Cases) %>%
addTiles(attribution = attribution) %>%
setView(lat = "38.8858", lng = "-77.1054", zoom = 8) %>%
addPolygons(stroke=T,
opacity = 1,
fillOpacity = 0.9,
smoothFactor = 0.5,
color = "black",
fillColor = ~dmvPalette(Cases),
weight = 0.5,
label = legendText,
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "3px 8px"),
textsize = "13px",
direction = "auto"
)) %>%
addLegend( pal=dmvPalette, values=~Cases, opacity=0.9, title = paste("DMV Covid-19 Cases on", Sys.Date()), position = "topright" )
DMV_Cases
myBins <- round(c(as.integer(unname(quantile(DMV_Cases$Cases, na.rm = T))), Inf), 0)
dmvPalette <- colorBin(palette = "YlOrRd", domain = DMV_Cases$Cases, na.color = "transparent", bins = myBins)
leaflet(DMV_Cases) %>%
addTiles(attribution = attribution) %>%
setView(lat = "38.8858", lng = "-77.1054", zoom = 8) %>%
addPolygons(stroke=T,
opacity = 1,
fillOpacity = 0.9,
smoothFactor = 0.5,
color = "black",
fillColor = ~dmvPalette(Cases),
weight = 0.5,
label = legendText,
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "3px 8px"),
textsize = "13px",
direction = "auto"
)) %>%
addLegend( pal=dmvPalette, values=~Cases, opacity=0.9, title = paste("DMV Covid-19 Cases on", Sys.Date()), position = "topright" )
max(DMV_Cases$Cases)
max(DMV_Cases$Cases)
ceiling(max(DMV_Cases$Cases))
?ceiling
ceiling(max(DMV_Cases$Cases), 1)
(max(DMV_Cases$Cases) + 1)
myBins <- round(seq(from = 1, to = (max(DMV_Cases$Cases) + 1), by = (max(DMV_Cases$Cases) / 6)), 0)
round(seq(from = 1, to = (max(DMV_Cases$Cases) + 1), by = (max(DMV_Cases$Cases) / 6)), 0)
dmvPalette <- colorBin(palette = "YlOrRd", domain = DMV_Cases$Cases, na.color = "transparent", bins = myBins)
leaflet(DMV_Cases) %>%
addTiles(attribution = attribution) %>%
setView(lat = "38.8858", lng = "-77.1054", zoom = 8) %>%
addPolygons(stroke=T,
opacity = 1,
fillOpacity = 0.9,
smoothFactor = 0.5,
color = "black",
fillColor = ~dmvPalette(Cases),
weight = 0.5,
label = legendText,
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "3px 8px"),
textsize = "13px",
direction = "auto"
)) %>%
addLegend( pal=dmvPalette, values=~Cases, opacity=0.9, title = paste("DMV Covid-19 Cases on", Sys.Date()), position = "topright" )
dmvChloropleth <- leaflet(DMV_Cases) %>%
addTiles(attribution = attribution) %>%
setView(lat = "38.8858", lng = "-77.1054", zoom = 8) %>%
addPolygons(stroke=T,
opacity = 1,
fillOpacity = 0.9,
smoothFactor = 0.5,
color = "black",
fillColor = ~dmvPalette(Cases),
weight = 0.5,
label = legendText,
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "3px 8px"),
textsize = "13px",
direction = "auto"
)) %>%
addLegend( pal=dmvPalette, values=~Cases, opacity=0.9, title = paste("DMV Covid-19 Cases on", Sys.Date()), position = "topright" )
setwd("/home/adrian/Documents/Personal_Portfolio_Site/DMV_Covid-19")
mapshot(dmvChloropleth, url = "dmvChloropleth.html")
DMV_Counties_Covid_Cases_Today
View(DMV_Counties_Covid_Cases_Today)
str(DMV)
DMV %>% filter(GEOID == "51600")
DMV_Cases %>% filter(GEOID == "51600")
